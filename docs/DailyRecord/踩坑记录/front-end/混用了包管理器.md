---
outline: [2, 6]
tag: ['pnpm', '工程化', '前端']
---

## 为什么我的项目里同时存在package-lock.json和pnpm-lock.yaml?

出现**「双 lock 文件」**并不是 pnpm 的 bug，99 % 是因为 有人（或 CI）**混用了两套包管理器**。

```bash
# 1. 看最后是谁改了 lock
git log --oneline -- package-lock.json pnpm-lock.yaml

# 2. 搜仓库里有没有 npm 命令
grep -r "npm i" . --include="*.yml" --include="*.json" --include="*.md"
```

**怎么干净地切到 pnpm**

1. 删旧锁
```bash
rm -f package-lock.json && git add -A
```
2. 只保留 pnpm
```bash
echo "package-lock=false" >> .npmrc        # 告诉 npm 别再生
echo "engine-strict=true" >> .npmrc        # 可选：强制用 pnpm
```
3. 可选：加 preinstall 钩子（发现有人误用 npm 直接失败）
```json
"scripts": {
  "preinstall": "npx only-allow pnpm"
}
```
4. 提交 & 推远端，CI/同事全部改用 `pnpm install`。