---
outline: [2, 6]
tag: ['vitepress搭建', '创建自定义布局']
---

# 创建自定义布局

本文演示如何在vitepress中搭建自己的布局, 并结合@vueuse/motion动画库实现布局动效
主要还原了一下这位大佬的项目 [hacxy/vitepress-theme-mild](https://github.com/hacxy/vitepress-theme-mild)

## 安装依赖

需要安装:
::: CTcode

```sh
pnpm add nanostores tinyglobby @nanostores/vue @vueuse/components @vueuse/motion @vueuse/core gray-matter reading-time-estimator motion-v
```

:::

- 解析frontmatter: [gray-matter](https://github.com/jonschlinkert/gray-matter) vitepress 官方在使用的库
- 文件路径查找: [tinyglobby](https://github.com/SuperchupuDev/tinyglobby) 这也是 vitepress 官方在使用的库
- 动画效果: [@vueuse/motion](https://motion.vueuse.org/) 支持指令和自定义指令, 非常好用
- Hooks: [vueuse](https://github.com/vueuse/vueuse)
- 开源动画库：[Motion for Vue](https://github.com/motiondivision/motion-vue) vue组件的motion
- 获取文章阅读时间: [reading-time-estimator](https://github.com/lbenie/reading-time-estimator) 这个支持国际化
- 小型状态管理器: [nanostores](https://github.com/nanostores/nanostores) 存储文章数据之类的
- nanostores的vue支持：[@nanostores/vue](https://github.com/nanostores/vue) 可以把nano的存储对象变为响应式

## 创建需要的Vue组件

我们要实现的是一个列表展示文章、带有瀑布流动画的页面

### 布局组件

首先，需要一个vue文件作为页面布局，这里我们姑且叫`BlogLayout.vue`
::: CTcode BlogLayout.vue
<<< ../../../../.vitepress/theme/layouts/BlogLayout.vue
:::

这里嵌套了个文章列表组件和初始化数据的方法`useInitData()`，下面会提到。

### 文章列表组件

上面的`BlogLayout.vue`文件是一个布局文件，它的作用是定义页面的布局结构，并包含页面的标题、导航栏、内容区域等。
里面嵌套了一个文章列表组件`EnhancedArticlesList.vue`，这个组件会根据传入的参数来渲染文章列表。

::: CTcode EnhancedArticlesList.vue
<<< ../../../../.vitepress/theme/components/EnhancedArticlesList.vue
:::

解释一下代码部分：
::: CTcode

```js
import { useStore } from '@nanostores/vue'; // 引入状态管理库的vue方法
import { $posts } from '../store/posts'; // 引入文章数据

const posts = useStore($posts); // 把全局文章对象变为响应式对象
```

:::
这样我们就可以对文章数据进行基本的vue代码编写了，示例只是参考，想写成啥样都行

### 文章数据获取

这里是一个获取到文章数据的js

使用`vitepress`官方也在使用的库`tinyglobby`文件路径查找，加载对应文件夹下的md文件

使用`vitepress`官方也在使用的库`gray-matter`解析frontmatter

::: CTcode
<<< ../../../../.vitepress/theme/data/posts.data.js
:::

### 文章数据处理方法

一些全局文章对象通用的方法以供调用
::: CTcode
<<< ../../../../.vitepress/theme/store/posts.js
:::

### 初始化数据方法

这里是一个调用文章全局状态对象的钩子方法`useInitData.js`
::: CTcode
<<< ../../../../.vitepress/theme/hooks/useInitData.js
:::
这里调用了处理Markdown解析器获取文章数据的`posts.data`，以及设置全局文章对象的方法`posts.data`

## 注册布局组件

上面的组件和方法编写完毕后，我们需要引入组件

在项目的`.vitepress/theme/index.js`中
::: CTcode

```js{1-6,19-22}
// 导入动画组件
import { Motion } from 'motion-v';
import { MotionPlugin } from '@vueuse/motion';
// 导入布局组件
import BlogLayout from './layouts/BlogLayout.vue';
import EnhancedArticlesList from './components/EnhancedArticlesList.vue';

export default {
  extends: DefaultTheme,
  // ...DefaultTheme, //或者这样写也可
  // 插槽
  Layout: () => {
    return h(DefaultTheme.Layout, null, {
      // https://vitepress.dev/guide/extending-default-theme#layout-slots
    });
  },
  enhanceApp({ app }) {
    // 注册全局组件
    app.component('MotionComponent', Motion);
    app.component('BlogLayout', BlogLayout);
    app.component('EnhancedArticlesList', EnhancedArticlesList);
    app.use(MotionPlugin);
  },
};
```

:::

## 使用布局

我们需要去config给一个md文件创建路由(这里不再赘述)，并设置布局的formmatter参数为自定义的布局名称
::: CTcode

```md
---
layout: blog-layout // 或者你使用驼峰命名BlogLayout也可以，不影响
// 记得前面编写的js文件posts.data.js吗？下面这里是我们在里面创建的参数可以设置
// 到时候在组件里拿到文章数据的响应式对象时，就可以用这个对象来获取这些formmatter参数了
article:    
  title: 我的博客文章
---
```

:::

## 文章动画效果

详细请看[文章动画效果](./文章动画效果.md)
