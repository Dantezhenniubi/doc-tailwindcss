---
outline: [2, 6]
tag: ['vitepress搭建', '自定义布局', '自定义主题']

---

# 替换黑暗模式切换按钮
总感觉默认的切换按钮不符合我的审美，该如何自定义呢？

vitepress官方提到，可以使用组件别名来替换默认的布局组件：[官方](https://vitepress.dev/guide/extending-default-theme#overriding-internal-components)

那我们首先要做的就是找到想要替换的[vitepress组件源码](https://github.com/vuejs/vitepress/tree/main/src/client/theme-default/components)，然后编写自己的组件

通过查找，我们找到了两个组件：[`VPSwitchAppearance.vue`](https://github.com/vuejs/vitepress/blob/main/src/client/theme-default/components/VPSwitchAppearance.vue)和[`VPSwitch.vue`](https://github.com/vuejs/vitepress/blob/main/src/client/theme-default/components/VPSwitch.vue)

## 解读源码
为了便于解读，我们贴出源码(本教程编写时源码，最好请参照最新官方源码)：
::: CTcode VPSwitchAppearance.vue
```vue
<script lang="ts" setup>
import { inject, ref, watchPostEffect } from 'vue'
import { useData } from '../composables/data'
import VPSwitch from './VPSwitch.vue'

const { isDark, theme } = useData()

const toggleAppearance = inject('toggle-appearance', () => {
  isDark.value = !isDark.value
})

const switchTitle = ref('')

watchPostEffect(() => {
  switchTitle.value = isDark.value
    ? theme.value.lightModeSwitchTitle || 'Switch to light theme'
    : theme.value.darkModeSwitchTitle || 'Switch to dark theme'
})
</script>

<template>
  <VPSwitch
    :title="switchTitle"
    class="VPSwitchAppearance"
    :aria-checked="isDark"
    @click="toggleAppearance"
  >
    <span class="vpi-sun sun" />
    <span class="vpi-moon moon" />
  </VPSwitch>
</template>

<style scoped>
.sun {
  opacity: 1;
}

.moon {
  opacity: 0;
}

.dark .sun {
  opacity: 0;
}

.dark .moon {
  opacity: 1;
}

.dark .VPSwitchAppearance :deep(.check) {
  /*rtl:ignore*/
  transform: translateX(18px);
}
</style>
```
:::

:::  CTcode VPSwitch.vue
```vue
<template>
  <button class="VPSwitch" type="button" role="switch">
    <span class="check">
      <span class="icon" v-if="$slots.default">
        <slot />
      </span>
    </span>
  </button>
</template>

<style scoped>
.VPSwitch {
  position: relative;
  border-radius: 11px;
  display: block;
  width: 40px;
  height: 22px;
  flex-shrink: 0;
  border: 1px solid var(--vp-input-border-color);
  background-color: var(--vp-input-switch-bg-color);
  transition: border-color 0.25s !important;
}

.VPSwitch:hover {
  border-color: var(--vp-c-brand-1);
}

.check {
  position: absolute;
  top: 1px;
  /*rtl:ignore*/
  left: 1px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background-color: var(--vp-c-neutral-inverse);
  box-shadow: var(--vp-shadow-1);
  transition: transform 0.25s !important;
}

.icon {
  position: relative;
  display: block;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  overflow: hidden;
}

.icon :deep([class^='vpi-']) {
  position: absolute;
  top: 3px;
  left: 3px;
  width: 12px;
  height: 12px;
  color: var(--vp-c-text-2);
}

.dark .icon :deep([class^='vpi-']) {
  color: var(--vp-c-text-1);
  transition: opacity 0.25s !important;
}
</style>
```
:::
可以看到，`VPSwitchAppearance.vue`组件是包含了暗黑模式切换的业务逻辑的，`VPSwitch.vue`组件只是基础开关组件的封装，不包含业务逻辑

### VPSwitch.vue
`VPSwitch.vue` 是 VitePress 中的基础开关组件，它提供了一个可复用的开关 UI 元素。这个组件不包含任何业务逻辑，只是一个视觉和交互组件。

#### 模板结构
::: CTcode
```vue
<template>
  <button class="VPSwitch" type="button" role="switch">
    <span class="check">
      <span class="icon" v-if="$slots.default">
        <slot />
      </span>
    </span>
  </button>
</template>
```
:::
- 使用 `<button>` 元素作为根元素，设置了 `type="button"` 和 `role="switch"` 以提升可访问性
- 内部包含一个 `.check` 元素，代表开关的滑块
- `.icon` 元素用于显示图标，通过 `$slots.default` 判断是否有内容传入
- 使用 `<slot />` 实现内容插槽，允许父组件传入自定义图标

#### 样式
::: CTcode
```css
.VPSwitch {
  position: relative;
  border-radius: 11px;
  display: block;
  width: 40px;
  height: 22px;
  flex-shrink: 0;
  border: 1px solid var(--vp-input-border-color);
  background-color: var(--vp-input-switch-bg-color);
  transition: border-color 0.25s !important;
}
```
:::
- 使用相对定位
- 圆角设计 (border-radius: 11px)
- 固定尺寸 (40px x 22px)
- 使用 CSS 变量定义颜色，便于主题适配
::: CTcode
```css
.check {
  position: absolute;
  top: 1px;
  left: 1px;
  width: 18px;
  height: 18px;
  border-radius: 50%;
  background-color: var(--vp-c-neutral-inverse);
  box-shadow: var(--vp-shadow-1);
  transition: transform 0.25s !important;
}
```
:::
- 绝对定位，便于控制位置
- 圆形设计 (border-radius: 50%)
- 使用 CSS 变量定义颜色和阴影
- 添加了过渡动画效果

### VPSwitchAppearance.vue
VPSwitchAppearance.vue 是基于 VPSwitch.vue 的专门用于切换暗黑模式的组件。

#### 脚本部分
::: CTcode VPSwitchAppearance.vue
```vue
<script lang="ts" setup>
import { inject, ref, watchPostEffect } from 'vue'
import { useData } from '../composables/data'
import VPSwitch from './VPSwitch.vue'

const { isDark, theme } = useData()

const toggleAppearance = inject('toggle-appearance', () => {
  isDark.value = !isDark.value
})

const switchTitle = ref('')

watchPostEffect(() => {
  switchTitle.value = isDark.value
    ? theme.value.lightModeSwitchTitle || 'Switch to light theme'
    : theme.value.darkModeSwitchTitle || 'Switch to dark theme'
})
</script>
```
:::
- 使用 `useData()` 获取当前主题数据，包括 `isDark` 状态和 `theme` 配置
- 通过 `inject` 获取父组件提供的切换方法 `toggle-appearance`
- 使用 `watchPostEffect` 监听 `isDark` 状态变化，动态设置提示文字

#### 模板结构
::: CTcode
```vue
<template>
  <VPSwitch
    :title="switchTitle"
    class="VPSwitchAppearance"
    :aria-checked="isDark"
    @click="toggleAppearance"
  >
    <span class="vpi-sun sun" />
    <span class="vpi-moon moon" />
  </VPSwitch>
</template>
```
:::
组件特点：

1. 使用了前面分析的 `VPSwitch` 组件作为基础
2. 通过 `title` 属性提供鼠标悬停提示
3. 使用 `aria-checked` 属性增强可访问性
4. 通过点击事件触发切换方法
5. 插入了太阳和月亮图标，用于表示亮色和暗色模式

#### 样式
::: CTcode
```css
.sun {
  opacity: 1;
}

.moon {
  opacity: 0;
}

.dark .sun {
  opacity: 0;
}

.dark .moon {
  opacity: 1;
}
```
:::
图标切换逻辑：

- 默认状态下显示太阳图标，隐藏月亮图标
- 在 .dark 类下隐藏太阳图标，显示月亮图标

::: CTcode
```css
.dark .VPSwitchAppearance :deep(.check) {
  transform: translateX(18px);
}
```
:::

滑块位置控制：

- 在暗色模式下，将滑块向右移动 18px，表示切换到暗色模式

### DarkSwitch.vue
假设`DarkSwitch.vue` 是你创建的自定义暗黑模式切换组件。
#### 模板部分
::: CTcode
```vue
<template>
  <label class="switch" :title="switchTitle">
    <input type="checkbox" :checked="isDark" @change="toggleAppearance" />
    <span class="slider"></span>
  </label>
</template>
```
:::
使用`<label>`包裹整个组件，提升可访问性
使用原生 `<input type="checkbox">` 作为核心交互元素
通过 `:checked` 属性绑定当前暗黑模式状态
通过 `@change` 事件触发切换方法

####  脚本部分
::: CTcode
```vue
<script lang="ts" setup>
import { inject, watchPostEffect, ref } from 'vue';
import { useData } from 'vitepress';

const { isDark, theme } = useData();

const toggleAppearance = inject('toggle-appearance', () => {
  isDark.value = !isDark.value;
});

const switchTitle = ref('');

watchPostEffect(() => {
  switchTitle.value = isDark.value
    ? theme.value.lightModeSwitchTitle || 'Switch to light theme'
    : theme.value.darkModeSwitchTitle || 'Switch to dark theme';
});
</script>
```
:::
这部分与 VPSwitchAppearance.vue 基本相同，都是通过 `useData()` 获取状态，通过 `inject` 获取vitepress内部提供的切换方法。

#### 样式部分
::: CTcode
```css
@reference "tailwindcss";
/* The switch - the box around the slider */
.switch {
  font-size: 1rem;
  position: relative;
  display: inline-block;
  width: 4em;
  height: 2em;
  margin: 0;
}
```
:::
组件容器样式：

- 使用相对单位 (em)，确保响应式设计
- 固定宽高比 (4:2)

::: CTcode
```css
/* Hide default HTML checkbox */
.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}
```
:::
隐藏原生复选框：

- 通过透明度和尺寸设置隐藏原生复选框
- 保留其功能，用于状态控制

::: CTcode
```css
/* The slider */
.slider {
  position: absolute;
  cursor: pointer;
  inset: 0;
  background-color: #eee;
  transition: 0.4s;
  border-radius: 0.5em;
  box-shadow: 0 0.2em #dfd9d9;
}
```
:::
滑块轨道样式：

- 绝对定位填充容器
- 圆角设计
- 添加阴影效果
- 平滑过渡动画

::: CTcode
```css
.slider:before {
  position: absolute;
  content: '';
  height: 1.5em;
  width: 1.4em;
  border-radius: 0.3em;
  left: 0.3em;
  bottom: 0.7em;
  background-color: lightsalmon;
  transition: 0.4s;
  box-shadow: 0 0.4em #bcb4b4;
}
```
:::
滑块按钮样式：

- 使用伪元素创建
- 设置尺寸、颜色和阴影
- 添加过渡动画

::: CTcode
```css
.slider:hover::before {
  box-shadow: 0 0.2em #bcb4b4;
  bottom: 0.5em;
}

input:checked + .slider:before {
  transform: translateX(2em);
  background: lightgreen;
}
```
:::
交互效果：

- 鼠标悬停时改变阴影和位置
- 选中状态时滑块移动和颜色变化

::: CTcode
```css
/* Dark mode specific styles */
.dark .slider {
  background-color: #6a6a6a;
  box-shadow: 0 0.2em #444;
}

.dark .slider:before {
  background-color: #ff7b54;
  box-shadow: 0 0.4em #222;
}

.dark input:checked + .slider:before {
  background: #4caf50;
}
```
:::
暗色模式适配：

- 使用 `.dark` 前缀定义特殊样式
- 调整颜色和阴影以适应暗色模式


## 如何替换
在vitepress的config配置文件中添加以下配置：

::: CTcode
```js
// vite 配置
  vite: {
    // 替换默认组件
    resolve: {
      alias: [
        {
          find: /^.*\/VPSwitchAppearance\.vue$/,  // 你要替换的vitepress默认组件名
          replacement: fileURLToPath(new URL('./theme/components/DarkSwitch.vue', import.meta.url)),  // 你要替换的组件所在路径
        },
      ],
    },
  },
```
:::