---
outline: [2, 6]
tag: ['vitepress搭建', '动画效果']
---

# 文章动画效果

在[大佬的项目](https://github.com/hacxy/vitepress-theme-mild)看到了文章瀑布流的动画效果，本文尝试还原实现这个效果。

## 思路

其实一开始绕了很多弯子，也是技术水平不行。。

原因是纯CSS实现的瀑布流效果不尽人意：

纯CSS可以实现基础的文字动画效果，但有以下显著限制：

1. 无法实现真实的物理弹簧动画
2. 难以根据元素位置智能计算延迟
3. 滚动触发控制不够精确
4. 缺乏动态参数调整能力
5. 大规模动画序列管理困难

比如页面有一百多个元素时，在性能上也是非常灾难性的。。。

所以，我决定使用@vueuse/motion来实现瀑布流动画效果，免费开源、良好的vue支持，和完善的api，实现起来比较轻松

## 实现原理

### 编写动画组件

动画库使用的是`@vueuse/motion`，这个库的动画效果非常强，但是需要定义动画对象
详情可参照[@vueuse/motion官方文档](https://motion.vueuse.org/api/use-motion)

vitepress的默认布局中，我们在浏览Markdown文章时默认使用的是`doc`布局，详情请看[vitepress官方文档](https://vitepress.dev/reference/default-theme-layout#doc-layout)

它的工作原理是将整个内容包裹在`vp-doc`CSS 类中，并将样式应用于其下的元素。

几乎所有通用元素（例如p、 或h2 ）都会获得特殊样式。

我们需要将元素应用到`vp-doc`所有的h标题、p标签、li标签上，这样就能实现瀑布流效果了

下面是动画组件的参考：
::: CTcode DocTextAnimation.vue
<<< ../../../../.vitepress/theme/components/DocTextAnimation.vue
:::

## 使用插槽引入组件

vitepress官方提供了很多布局插槽供我们使用，这里我们可以利用其中一个插槽来实现组件样式的注入

详细可查看[vitepress官方文档](https://vitepress.dev/guide/extending-default-theme#layout-slots)

本项目选择的是**使用`h`来渲染组件**，而非创建一个额外的拓展的布局组件再使用`<template #doc-after></template>`这样的插槽

因为我们实现的功能需求仅仅是添加瀑布流动画的样式罢了

在`.vitepress/theme/index.js`中：
::: CTcode

```js{}
// 导入动画组件
import { Motion } from 'motion-v';
import { MotionPlugin } from '@vueuse/motion';
import DocTextAnimation from './components/DocTextAnimation.vue';

export default {
  extends: DefaultTheme,
  // ...DefaultTheme, //或者这样写也可
  // 插槽
  Layout: () => {
    return h(DefaultTheme.Layout, null, {
      // https://vitepress.dev/guide/extending-default-theme#layout-slots
      'doc-after': () => h(DocTextAnimation), // 文章动画
    });
  },
  enhanceApp({ app }) {
    // 注册全局组件
    app.component('MotionComponent', Motion);
    app.use(MotionPlugin);
  },
};
```

:::

好了，现在你可以打开一篇博客文章，可以看到文章内容有动画效果了~
